<div class="calc-box">
  <h2>SISTEMA <span class="accent">ERS</span></h2>
  <form [formGroup]="form" (ngSubmit)="sim()" class="calc-box__form">
    <div class="group">
      <label>Coche</label>
      <select formControlName="carId">
        <option [ngValue]="null">-- Seleccionar --</option>
        @for (c of cars; track c.id) { <option [value]="c.id">{{c.nombre}}</option> }
      </select>
    </div>
    <div class="group">
      <label>Circuito</label>
      <select formControlName="circuitId">
        <option [ngValue]="null">-- Seleccionar --</option>
        @for (c of circuits; track c.id) { <option [value]="c.id">{{c.nombre}}</option> }
      </select>
    </div>
    <div class="group">
      <label>TIPO DE CONDUCCIÃ“N</label>
      <div class="radios">
        <label><input type="radio" formControlName="mode" value="AHORRADOR"><span>Ahorrador</span></label>
        <label><input type="radio" formControlName="mode" value="NORMAL"><span>Normal</span></label>
        <label><input type="radio" formControlName="mode" value="DEPORTIVO"><span>Deportivo</span></label>
      </div>
    </div>
    <button type="submit" [disabled]="form.invalid || loading">{{ loading ? '...' : 'SIMULAR' }}</button>
  </form>

  @if(result) {
    <div class="calc-box__res ers">
      <div class="battery-vis">
        <div class="level" [style.height.%]="result.porcentaje_recuperado"></div>
        <span class="txt">{{result.porcentaje_recuperado}}%</span>
      </div>
      <div class="stats">
        <div class="item"><span>RECUPERADO</span><strong>{{result.energia_recuperada_por_vuelta}} MJ</strong></div>
        <div class="item"><span>VUELTAS DE CARGA</span><strong>{{result.vueltas_para_carga_completa}}</strong></div>
      </div>
    </div>
  }
</div>